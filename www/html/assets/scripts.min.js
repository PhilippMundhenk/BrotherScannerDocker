function set_state_idle(){$("#status-image").html('<i class="far fa-smile fa-fw fa-10x"></i>'),$("#status-text").text("Ready to scan"),$(".trigger-scan").removeClass("disabled")}function set_state_waiting(){$("#status-image").html('<i class="fas fa-hourglass-half fa-fw fa-10x"></i>'),$("#status-text").text("Waiting for rear pages"),$(".trigger-scan").removeClass("disabled")}function set_state_scan(){let spinnerimage='<i class="fas fa-spinner fa-spin fa-fw fa-10x"></i>';spinnerimage!=$("#status-image").html()&&$("#status-image").html(spinnerimage),$("#status-text").text("Scan in progress"),$(".trigger-scan").addClass("disabled")}function set_state_ocr(){$("#status-image").html('<i class="fas fa-brain fa-fw fa-10x"></i>'),$("#status-text").text("OCR in progress"),$(".trigger-scan").removeClass("disabled")}function set_state(state){switch(state){case"idle":set_state_idle();break;case"waiting":set_state_waiting();break;case"scan":set_state_scan();break;case"ocr":set_state_ocr();break;default:set_state_idle()}}function load_files_offcanvas(){$.ajax({url:"/list-files",method:"GET",success:function(response){$("#offcanvasContent").html(response)},error:function(xhr,status,error){console.error("Failed to load content:",error)}})}function toggle_file_rename(source_element){var parentDiv,parentId=source_element.closest(".list-group-item").attr("id");$("#"+parentId+" .file-info-label-default").toggleClass("d-none"),$("#"+parentId+" .file-info-label-rename").toggleClass("d-none"),$("#"+parentId+" .file-name").toggleClass("d-none"),$("#"+parentId+" .file-name-new").toggleClass("d-none"),$("#"+parentId+" .file-buttons-default").toggleClass("d-none"),$("#"+parentId+" .file-buttons-rename").toggleClass("d-none"),$("#"+parentId+" .file-rename-prefix-date").checked=!0}function toggle_file_delete(source_element){var parentDiv,parentId=source_element.closest(".list-group-item").attr("id");$("#"+parentId+" .file-info-label-default").toggleClass("d-none"),$("#"+parentId+" .file-info-label-delete").toggleClass("d-none"),$("#"+parentId+" .file-buttons-default").toggleClass("d-none"),$("#"+parentId+" .file-buttons-delete").toggleClass("d-none")}function toggle_file_error(parentId,message){$("#"+parentId).addClass("bg-danger text-white");var html=' <div class="m-0 d-flex w-100 align-items-center justify-content-between m-0 py-4">\n                    <strong class="fs-4 fw-bolder">'+message+'</strong>\n                    <small><button type="button" class="btn btn-dark refresh-files m-0 me-2">OK</button></small>\n                </div>';$("#"+parentId).html(html)}function toggle_file_success(parentId,message){$("#"+parentId).addClass("bg-success text-white");var html=' <div class="m-0 d-flex w-100 align-items-center justify-content-between m-0 py-4">\n                    <strong class="fs-4 fw-bolder">'+message+'</strong>\n                    <small><button type="button" class="btn btn-dark refresh-files m-0 me-2">OK</button></small>\n                </div>';$("#"+parentId).html(html)}$(document).ready((function(){$(".trigger-scan").click((function(){var target=$(this).data("trigger");console.log('Triggered click event on element with class "trigger-scan" and data-trigger "'+target+'"'),$.post("/api/scanner/scanto",{target:target},(function(data){console.log(data),$(this).blur()}))})),setInterval((function(){$.get("/api/scanner/status",(function(data){let state="idle";data.ocr&&data.waiting&&!data.scan?state="ocr":data.scan&&data.waiting?state="scan":data.scan?state="scan":data.ocr&&!data.scan?state="ocr":data.ocr||data.scan||!data.waiting?data.ocr||data.scan||data.waiting||(state="idle"):state="waiting",set_state(state)}))}),1e3),$("#triggerFiles").on("click",(function(e){var offcanvas;e.preventDefault(),load_files_offcanvas(),new bootstrap.Offcanvas($("#offcanvasFiles")[0]).show()}))})),$(document).on("click",".refresh-files",(function(e){e.preventDefault(),load_files_offcanvas()})),$(document).on("click",".file-rename",(function(e){e.preventDefault(),toggle_file_rename($(this))})),$(document).on("click",".file-rename-confirm",(function(e){e.preventDefault(),url=$(this).attr("href");var parentDiv,parentId=$(this).closest(".list-group-item").attr("id"),filename=$("#"+parentId+" .file-name-original").val(),new_filename=$("#"+parentId+" .file-name-new").val(),new_filename_prefix="none";$("#"+parentId+" .file-rename-prefix-none").is(":checked")&&(new_filename_prefix="none"),$("#"+parentId+" .file-rename-prefix-date").is(":checked")&&(new_filename_prefix="date"),$("#"+parentId+" .file-rename-prefix-datetime").is(":checked")&&(new_filename_prefix="datetime"),console.log("url: "+url),console.log("filename: "+filename),console.log("new_filename: "+new_filename),console.log("new_filename_prefix: "+new_filename_prefix),""==new_filename&&"none"==new_filename_prefix?alert("Please enter a new filename or select a prefix"):(payload={new_filename:new_filename,new_filename_prefix:new_filename_prefix},console.log(payload),$.ajax({url:url,type:"PUT",contentType:"application/json",data:JSON.stringify(payload),success:function(response){console.log(response),console.log("File renamed"),toggle_file_rename($(this)),load_files_offcanvas()},error:function(xhr,status,error){console.log("File NOT renamed"),toggle_file_error(parentId,"Rename failed")}}))})),$(document).on("click",".file-rename-cancel",(function(e){e.preventDefault(),toggle_file_rename($(this))})),$(document).on("click",".file-delete",(function(e){e.preventDefault(),toggle_file_delete($(this))})),$(document).on("click",".file-delete-confirm",(function(e){e.preventDefault();var parentDiv,parentId=$(this).closest(".list-group-item").attr("id");url=$(this).attr("href"),$.ajax({url:url,type:"DELETE",success:function(response){toggle_file_success(parentId,"File deleted"),setTimeout(()=>{load_files_offcanvas()},500)},error:function(response,xhr,status,error){toggle_file_error(parentId,"Delete failed")}})})),$(document).on("click",".file-delete-cancel",(function(e){e.preventDefault(),toggle_file_delete($(this))}));